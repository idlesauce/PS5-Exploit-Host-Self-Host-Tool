#!/bin/bash

if [ "$EUID" -ne 0 ]; then
  echo "This script must be run as root"
  exit
fi

SERVICE_NAME="PS5-Exploit-Host-Self-Host-Tool"
DEST_DIR="/usr/local/bin"
EXECUTABLE_NAME="PS5-Exploit-Host-Self-Host-Tool"

echo "Stopping $SERVICE_NAME service..."
systemctl stop $SERVICE_NAME

echo "Disabling $SERVICE_NAME service..."
systemctl disable $SERVICE_NAME

echo "Removing $SERVICE_NAME service file..."
rm /etc/systemd/system/$SERVICE_NAME.service

echo "Reloading systemd daemon..."
systemctl daemon-reload

echo "Removing $EXECUTABLE_NAME from $DEST_DIR..."
# the filename might have a suffix like -linux-x64
rm $DEST_DIR/$EXECUTABLE_NAME*

echo "Removing app data..."

USER_FOLDERS=$(awk -F: '($6 ~ /^\/home/ || $6 == "/root") { print $6 }' /etc/passwd)
for USER_FOLDER in $USER_FOLDERS; do
  rm -rf $USER_FOLDER/.ps5-exploit-host
done

echo ""
echo "Uninstallation complete!"